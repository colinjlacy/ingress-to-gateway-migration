# Install command:
# helm upgrade --install ingress-nginx ingress-nginx \
#   --repo https://kubernetes.github.io/ingress-nginx \
#   --namespace ingress-nginx --create-namespace \
#   --values helm/ingress-nginx-values.yaml

controller:
  ingressClass: nginx
  ingressClassResource:
    name: nginx
    enabled: true
    default: false
    controllerValue: "k8s.io/ingress-nginx"
  service:
    type: LoadBalancer
    ports:
      http: 80
      https: 443
    targetPorts:
      http: http
      https: http
    
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
      service.beta.kubernetes.io/aws-load-balancer-ssl-cert: "arn:aws:acm:us-east-2:391633600189:certificate/62c55457-4166-492d-81c7-ff41df21e000"
      service.beta.kubernetes.io/aws-load-balancer-ssl-ports: "443"
      service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "http"
      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"     
      service.beta.kubernetes.io/aws-load-balancer-subnets: "subnet-018fa89cfedb3bbb1,subnet-0331a10307fbf3f5c,subnet-04ec405974e48ab44"
      service.beta.kubernetes.io/aws-load-balancer-additional-resource-tags: "Project=gateway-migration-demo,Controller=ingress-nginx,Environment=demo,CostCenter=engineering"
    externalTrafficPolicy: Local
  resources:
    requests:
      cpu: 100m
      memory: 90Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Replica count for high availability
  replicaCount: 2

  # ConfigMap entries for TLS termination at NLB
  config:
    use-proxy-protocol: "false"
    force-ssl-redirect: "false"
    ssl-redirect: "false"
    proxy-buffer-size: "16k"
    proxy-buffers-number: "4"
    client-header-buffer-size: "16k"
    large-client-header-buffers: "4 16k"
    http-snippet: |
      map $http_x_forwarded_proto $pass_access_scheme {
        default "https";
      }
      map $http_x_forwarded_proto $pass_port {
        default "443";
      }
# TCP services configuration for non-HTTP traffic
# Expose MySQL database on external port 3306
tcp:
  3306: "demo-gw-migration/catalogue-db:3306"

# Default backend (serves 404 for unmapped routes)
defaultBackend:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 10m
      memory: 20Mi
    limits:
      cpu: 50m
      memory: 64Mi
